

<% layout('layouts/boilerplate2') %>


<div class="container my-5">
  <div class="text-center mb-4">
    <h1 class="fw-bold text-success">‚ûï Add New Marketplace</h1>
    <p class="text-muted">Click on the map to select the exact location of the marketplace.</p>
  </div>

  <div class="card shadow-lg p-4 border-0 rounded-4">
    <form action="/markets" method="POST" id="marketForm">
      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Market Name</label>
          <input type="text" name="name" class="form-control" placeholder="e.g., Azadpur Mandi" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">District</label>
          <input type="text" name="district" class="form-control" placeholder="e.g., Delhi" required>
        </div>
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Address</label>
        <input type="text" name="address" class="form-control" placeholder="e.g., Near GT Road">
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">Contact</label>
        <input type="text" name="contact" class="form-control" placeholder="e.g., +91 9876543210">
      </div>

      <div class="mb-3">
        <label class="form-label fw-semibold">üìç Select Location on Map</label>
        <div id="map" class="rounded-4 shadow-sm border" style="height:400px;"></div>
        <small class="text-muted">Click on the map to auto-fill coordinates below.</small>
      </div>

      <div class="row">
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Latitude</label>
          <input type="number" step="any" name="latitude" class="form-control" required>
        </div>
        <div class="col-md-6 mb-3">
          <label class="form-label fw-semibold">Longitude</label>
          <input type="number" step="any" name="longitude" class="form-control" required>
        </div>
      </div>

      <button type="submit" class="btn btn-success w-100 fw-bold py-2">‚úÖ Add Marketplace</button>
    </form>
  </div>
</div>

<%- include("../includes/footer.ejs") %>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
  const map = L.map('map').setView([20.5937,78.9629],5);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);

  let marker;
  map.on('click', e => {
    const {lat, lng} = e.latlng;
    if (marker) map.removeLayer(marker);
    marker = L.marker([lat, lng], {
      icon: L.icon({
        iconUrl:"https://maps.google.com/mapfiles/ms/icons/green-dot.png",
        iconSize:[35,35], iconAnchor:[17,34]
      })
    }).addTo(map)
      .bindPopup(`üìç Lat: ${lat.toFixed(4)}<br>Lng: ${lng.toFixed(4)}`)
      .openPopup();
    document.querySelector('input[name="latitude"]').value = lat.toFixed(6);
    document.querySelector('input[name="longitude"]').value = lng.toFixed(6);
  });
</script>
